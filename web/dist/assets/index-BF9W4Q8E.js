import{c as h,r as l,u as W,a as D,g as q,e as B,f as I,s as n,j as t,T as P,X as V,h as F,i as R,k as U,t as H,l as X}from"./index-CvMYsqrU.js";import{n as G,P as J}from"./no-image-dark-Do-Ykov5.js";/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]],O=h("bookmark",K);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Y=h("check",Q);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],ee=h("info",Z);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],se=h("loader-circle",te);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],re=h("trash-2",ae),ie=()=>{const[o,g]=l.useState(null),[f,p]=l.useState([]),[y,w]=l.useState(null),[u,k]=l.useState({}),[j,b]=l.useState(!0),N=W(),{mode:x}=D(e=>e.theme),_=x==="dark"?"#fff":"#000",C=x==="dark"?"#0f0f0f":"#f9f9f9",E=x==="dark"?"#1e1e1e":"#fff",$=x==="dark"?"#2e2e2e":"#ddd";l.useEffect(()=>{q().then(g).catch(()=>g(null))},[]),l.useEffect(()=>{o&&(b(!0),B(o.id).then(async e=>{const a={};for(const c of e)try{const s=await I(c.anime_id);a[c.id]=s}catch(s){console.error("Erreur getAnimeById:",s)}k(a),p(e)}).catch(()=>n("Erreur chargement watch-list","error")).finally(()=>b(!1)))},[o]);const S=e=>{w(y===e?null:e)},A=async(e,a,c)=>{try{const s=await X(e.id,!e.watched);p(r=>r.map(i=>{var d;return i.id===c?{...i,seasons:(d=i.seasons)==null?void 0:d.map(m=>m.id===a?{...m,episodes:m.episodes.map(v=>v.id===s.id?s:v),id}:m)}:i}))}catch{n("Erreur de mise Ã  jour Ã©pisode","error")}},z=async(e,a)=>{try{const c=await H(e.id,!e.completed);p(s=>s.map(r=>{var i;return r.id===a?{...r,seasons:(i=r.seasons)==null?void 0:i.map(d=>d.id===c.id?{...d,completed:c.completed,episodes:d.episodes.map(m=>({...m,watched:c.completed}))}:d)}:r}))}catch{n("Erreur de mise Ã  jour saison","error")}},L=async e=>{var a;try{const c=await F(e.id);p(s=>s.map(r=>r.id===e.id?{...r,completed:!r.completed}:r)),n(c.completed?`${((a=u[e.id])==null?void 0:a.name)||"Anime"} marquÃ© comme vu`:"Marquage retirÃ©","success")}catch{n("Erreur lors du marquage","error")}},M=async e=>{var c;if(await R(`Supprimer "${((c=u[e.id])==null?void 0:c.name)||"cet anime"}" de ta watch-list ?`))try{await U(e.id),p(s=>s.filter(r=>r.id!==e.id)),n("Anime supprimÃ© de la liste","success")}catch{n("Erreur lors de la suppression","error")}},T=[...f].sort((e,a)=>e.completed===a.completed?0:e.completed?1:-1);return t.jsxs("div",{className:"min-h-screen transition-colors duration-500",style:{backgroundColor:C,color:_},children:[t.jsx(P,{}),t.jsxs("div",{className:"pt-24 px-4 max-w-6xl mx-auto space-y-6",children:[!o&&t.jsx("p",{className:"text-red-500 text-lg text-center",children:"Connecte-toi pour voir ta watch-list."}),o&&j&&t.jsx("div",{className:"flex justify-center items-center py-10",children:t.jsx(se,{className:"animate-spin text-gray-500",size:32})}),o&&!j&&f.length===0&&t.jsx("p",{className:"text-gray-500 text-center text-lg",children:"Ta watch-list est encore vide ðŸ’¤"}),o&&T.map(e=>{const a=u[e.id]||{},c=a.image_url;return t.jsx("div",{className:"rounded-2xl shadow-md overflow-hidden border transition-all hover:shadow-xl",style:{backgroundColor:E,borderColor:$},children:t.jsxs("div",{className:"flex flex-col sm:flex-row",children:[t.jsxs("div",{className:"sm:w-[160px] w-full h-[230px] sm:h-auto overflow-hidden cursor-pointer group relative",children:[t.jsx("img",{src:c?a.image_url:G,alt:a.name||`Anime ${e.anime_id}`,className:"w-full h-full object-cover group-hover:scale-105 transition-transform",onClick:()=>S(e.id)}),t.jsx("div",{className:"absolute inset-0 bg-black/30 opacity-0 group-hover:opacity-100 flex justify-center items-center transition",children:t.jsx(ee,{size:32,color:"#fff"})})]}),t.jsxs("div",{className:"flex-1 p-4 space-y-3 relative",children:[t.jsxs("div",{className:"flex justify-between items-start",children:[t.jsx("h3",{className:"text-xl font-semibold",children:a.name||`Anime ${e.anime_id}`}),t.jsx("div",{className:`flex items-center gap-1 px-3 py-1 rounded-full text-sm ${e.completed?"bg-green-600 text-white":"bg-gray-500 text-white"}`,children:e.completed?t.jsxs(t.Fragment,{children:[t.jsx(Y,{size:16})," Vu"]}):t.jsxs(t.Fragment,{children:[t.jsx(V,{size:16})," Pas vu"]})})]}),t.jsx("p",{className:"text-sm opacity-80 line-clamp-3",children:a.description||"Pas de description disponible."}),t.jsxs("div",{className:"flex flex-wrap gap-3 pt-2",children:[t.jsxs("button",{onClick:()=>N(`/details/${e.anime_id}`),className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-1.5 rounded-full text-sm shadow-md transition",children:[t.jsx(J,{size:16})," Regarder"]}),t.jsxs("button",{onClick:()=>L(e),className:`flex items-center gap-2 ${e.completed?"bg-gray-600 hover:bg-gray-700":"bg-emerald-600 hover:bg-emerald-700"} text-white px-4 py-1.5 rounded-full text-sm shadow-md transition`,children:[t.jsx(O,{size:16})," ",e.completed?"DÃ©marquer":"Marquer vu"]}),t.jsxs("button",{onClick:()=>M(e),className:"flex items-center gap-2 bg-red-600 hover:bg-red-700 text-white px-4 py-1.5 rounded-full text-sm shadow-md transition",children:[t.jsx(re,{size:16})," Supprimer"]})]}),y===e.id&&t.jsx("div",{className:"mt-4 border-t pt-3 space-y-3",children:(e.seasons||[]).map(s=>t.jsxs("div",{className:"border-b pb-2",children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsxs("span",{className:"font-semibold text-sm",children:["Saison ",s.season_id]}),t.jsx("button",{className:`px-2 py-1 rounded ${s.completed?"bg-green-500":"bg-gray-400"} text-white text-sm transition`,onClick:()=>z(s,e.id),children:s.completed?"TerminÃ©e":"Non terminÃ©e"})]}),t.jsx("div",{className:"ml-4 space-y-1",children:(s.episodes||[]).map(r=>t.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:r.watched,onChange:()=>A(r,s.id,e.id)}),"Ã‰pisode ",r.episode_id]},r.id))})]},s.id))})]})]})},e.id)})]})]})};export{ie as default};
